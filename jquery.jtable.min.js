(function($){let unloadingPage;$(window).on("beforeunload",function(){unloadingPage=true});$(window).on("unload",function(){unloadingPage=false});jTable=function(element,options){this.element=$(element);this.options=$.extend(true,{},this.options,options);this._create()};jTable.prototype={options:{tableId:undefined,actions:{},fields:{},animationsEnabled:true,defaultDateFormat:"yy-mm-dd",showCloseButton:false,loadingAnimationDelay:500,saveUserPreferences:true,jqueryuiTheme:false,unAuthorizedRequestRedirectUrl:null,listQueryParams:{},ajaxSettings:{type:"POST",dataType:"json"},toolbar:{hoverAnimation:true,hoverAnimationDuration:60,hoverAnimationEasing:undefined,items:[]},closeRequested:function(event,data){},formCreated:function(event,data){},formSubmitting:function(event,data){},formClosed:function(event,data){},loadingRecords:function(event,data){},recordsLoaded:function(event,data){},rowInserted:function(event,data){},rowsRemoved:function(event,data){},messages:{serverCommunicationError:"An error occured while communicating to the server.",loadingMessage:"Loading records...",noDataAvailable:"No data available!",areYouSure:"Are you sure?",save:"Save",saving:"Saving",cancel:"Cancel",error:"Error",close:"Close",cannotLoadOptionsFor:"Can not load options for field {0}"}},_$mainContainer:null,_$titleDiv:null,_$toolbarDiv:null,_$tableDiv:null,_$table:null,_$tableBody:null,_$tableRows:null,_$busyDialog:null,_$errorDialog:null,_columnList:null,_fieldList:null,_keyField:null,_firstDataColumnOffset:0,_lastPostData:null,_cache:null,_extraFieldTypes:[],_create:function(){this._normalizeFieldsOptions();this._initializeFields();this._createFieldAndColumnList();this._createMainContainer();this._createTableTitle();this._createToolBar();this._createTableDiv();this._createTable();this._createBusyDialog();this._createErrorDialog();this._addNoDataRow();this._cookieKeyPrefix=this._generateCookieKeyPrefix()},_normalizeFieldsOptions:function(){let self=this;$.each(self.options.fields,function(fieldName,props){self._normalizeFieldOptions(fieldName,props)})},_normalizeFieldOptions:function(fieldName,props){if(props.listClass==undefined){props.listClass=""}if(props.inputClass==undefined){props.inputClass=""}if(props.placeholder==undefined){props.placeholder=""}if(props.type==undefined){props.type="text"}if(props.dependsOn&&$.type(props.dependsOn)==="string"){let dependsOnArray=props.dependsOn.split(",");props.dependsOn=[];for(let i=0;i<dependsOnArray.length;i++){props.dependsOn.push($.trim(dependsOnArray[i]))}}},_initializeFields:function(){this._lastPostData={};this._$tableRows=[];this._columnList=[];this._fieldList=[];this._cache=[];this._extraFieldTypes=[]},_createFieldAndColumnList:function(){let self=this;$.each(self.options.fields,function(name,props){self._fieldList.push(name);if(props.key==true){self._keyField=name}if(props.list!=false&&props.type!="hidden"){self._columnList.push(name)}})},_createMainContainer:function(){this._$mainContainer=$("<div />").addClass("jtable-main-container").appendTo(this.element);this._jqueryuiThemeAddClass(this._$mainContainer,"ui-widget")},_createTableTitle:function(){let self=this;if(!self.options.title){return}let $titleDiv=$("<div />").addClass("jtable-title").appendTo(self._$mainContainer);self._jqueryuiThemeAddClass($titleDiv,"ui-widget-header");$("<div />").addClass("jtable-title-text").appendTo($titleDiv).append(self.options.title);if(self.options.showCloseButton){let $textSpan=$("<span />").html(self.options.messages.close);$("<button></button>").addClass("jtable-command-button jtable-close-button").attr("title",self.options.messages.close).append($textSpan).appendTo($titleDiv).click(function(e){e.preventDefault();e.stopPropagation();self._onCloseRequested()})}self._$titleDiv=$titleDiv},_createTableDiv:function(){this._$tableDiv=$("<div />").addClass("jtable-table-div").appendTo(this._$mainContainer)},_createTable:function(){this._$table=$("<table></table>").addClass("jtable").appendTo(this._$tableDiv);if(this.options.tableId){this._$table.attr("id",this.options.tableId)}this._jqueryuiThemeAddClass(this._$table,"ui-widget-content");this._createTableHead();this._createTableBody()},_createTableHead:function(){let $thead=$("<thead></thead>").appendTo(this._$table);this._addRowToTableHead($thead)},_addRowToTableHead:function($thead){let $tr=$("<tr></tr>").appendTo($thead);this._addColumnsToHeaderRow($tr)},_addColumnsToHeaderRow:function($tr){for(let i=0;i<this._columnList.length;i++){let fieldName=this._columnList[i];let $headerCell=this._createHeaderCellForField(fieldName,this.options.fields[fieldName]);$headerCell.appendTo($tr)}},_createHeaderCellForField:function(fieldName,field){field.width=field.width||"10%";let $headerTextSpan=$("<span />").addClass("jtable-column-header-text").html(field.title);let $headerContainerDiv=$("<div />").addClass("jtable-column-header-container").append($headerTextSpan);let $th=$("<th></th>").addClass("jtable-column-header").addClass(field.listClass).css("width",field.width).data("fieldName",fieldName).append($headerContainerDiv);this._jqueryuiThemeAddClass($th,"ui-state-default");return $th},_createEmptyCommandHeader:function(extraclass){let $th=$("<th></th>").addClass("jtable-command-column-header"+" "+extraclass).css("width","1%");this._jqueryuiThemeAddClass($th,"ui-state-default");return $th},_createTableBody:function(){this._$tableBody=$("<tbody></tbody>").appendTo(this._$table)},_createBusyDialog:function(){this._$busyDialog=$("<dialog />").addClass("jtable-busy-modal-dialog").prependTo(this._$mainContainer);this._$busyMessageDiv=$("<div />").addClass("jtable-busy-message").appendTo(this._$busyDialog);this._jqueryuiThemeAddClass(this._$busyMessageDiv,"ui-widget-header")},_createErrorDialog:function(){let self=this;self._$errorDialog=$("<dialog />").addClass("jtable-modal-dialog").appendTo(self._$mainContainer);$('<h2 id="errorDialogTitle"></h2>').css({padding:"0px"}).html(self.options.messages.error).appendTo(self._$errorDialog);$('<div><p><span class="jtable-error-message"></span></p></div>').appendTo(self._$errorDialog);$('<button class="jtable-dialog-button jtable-dialog-cancelbutton"></button>').html("<span>"+self.options.messages.close+"</span>").on("click",function(){self._closeErrorDialog()}).appendTo(self._$errorDialog)},_closeErrorDialog(){this._$errorDialog[0].close()},load:function(extraPostData,completeCallback){let listQueryParams={};if(typeof this.options.listQueryParams==="function"){listQueryParams=this.options.listQueryParams()}else{listQueryParams=this.options.listQueryParams}if(extraPostData){this._lastPostData={...listQueryParams,...extraPostData}}else{this._lastPostData=listQueryParams}this._reloadTable(completeCallback)},reload:function(completeCallback){this._reloadTable(completeCallback)},getRowByKey:function(key){for(let i=0;i<this._$tableRows.length;i++){if(key==this._getKeyValueOfRecord(this._$tableRows[i].data("record"))){return this._$tableRows[i]}}return null},destroy:function(){this.element.empty();$.Widget.prototype.destroy.call(this)},_setOption:function(key,value){},_reloadTable:function(completeCallback){let self=this;let completeReload=function(data){self._hideBusy();if(data.Result!="OK"){self._showError(data.Message);return}self._removeAllRows("reloading");self._addRecordsToTable(data.Records);self._onRecordsLoaded(data);if(completeCallback){completeCallback()}};self._showBusy(self.options.messages.loadingMessage,self.options.loadingAnimationDelay);self._onLoadingRecords();if($.isFunction(self.options.actions.listAction)){let funcResult=self.options.actions.listAction(self._lastPostData,self._createJtParamsForLoading());if(self._isDeferredObject(funcResult)){funcResult.done(function(data){completeReload(data)}).fail(function(){self._showError(self.options.messages.serverCommunicationError)}).always(function(){self._hideBusy()})}else{completeReload(funcResult)}}else{let loadUrl=self.options.actions.listAction;let extraparams=self._createJtParamsForLoading();self._ajax({url:loadUrl,data:{...self._lastPostData,...extraparams},success:function(data){completeReload(data)},error:function(){self._hideBusy();self._showError(self.options.messages.serverCommunicationError)}})}},_createJtParamsForLoading:function(){return{}},_createRowFromRecord:function(record){let $tr=$("<tr></tr>").addClass("jtable-data-row").attr("data-record-key",this._getKeyValueOfRecord(record)).data("record",record);this._addCellsToRowUsingRecord($tr);return $tr},_addCellsToRowUsingRecord:function($row){let record=$row.data("record");for(let i=0;i<this._columnList.length;i++){this._createCellForRecordField(record,this._columnList[i]).appendTo($row)}},_createCellForRecordField:function(record,fieldName){return $("<td></td>").addClass(this.options.fields[fieldName].listClass).append(this._getDisplayTextForRecordField(record,fieldName))},_addRecordsToTable:function(records){let self=this;$.each(records,function(index,record){self._addRow(self._createRowFromRecord(record))});self._refreshRowStyles()},_addRowToTable:function($tableRow,index,isNewRow,animationsEnabled){let options={index:this._normalizeNumber(index,0,this._$tableRows.length,this._$tableRows.length)};if(isNewRow==true){options.isNewRow=true}if(animationsEnabled==false){options.animationsEnabled=false}this._addRow($tableRow,options)},_addRow:function($row,options){options=$.extend({index:this._$tableRows.length,isNewRow:false,animationsEnabled:true},options);if(this._$tableRows.length<=0){this._removeNoDataRow()}options.index=this._normalizeNumber(options.index,0,this._$tableRows.length,this._$tableRows.length);if(options.index==this._$tableRows.length){this._$tableBody.append($row);this._$tableRows.push($row)}else if(options.index==0){this._$tableBody.prepend($row);this._$tableRows.unshift($row)}else{this._$tableRows[options.index-1].after($row);this._$tableRows.splice(options.index,0,$row)}this._onRowInserted($row,options.isNewRow);if(options.isNewRow){this._refreshRowStyles();if(this.options.animationsEnabled&&options.animationsEnabled){this._showNewRowAnimation($row)}}},_showNewRowAnimation:function($tableRow){let className="jtable-row-created";if(this.options.jqueryuiTheme){className=className+" ui-state-highlight"}$tableRow.addClass(className,"slow","",function(){$tableRow.removeClass(className,5e3)})},_removeRowsFromTable:function($rows,reason){let self=this;if($rows.length<=0){return}$rows.addClass("jtable-row-removed").remove();$rows.each(function(){let index=self._findRowIndex($(this));if(index>=0){self._$tableRows.splice(index,1)}});self._onRowsRemoved($rows,reason);if(self._$tableRows.length==0){self._addNoDataRow()}self._refreshRowStyles()},_findRowIndex:function($row){return this._findIndexInArray($row,this._$tableRows,function($row1,$row2){return $row1.data("record")==$row2.data("record")})},_removeAllRows:function(reason){if(this._$tableRows.length<=0){return}let $rows=this._$tableBody.find("tr.jtable-data-row");this._$tableBody.empty();this._$tableRows=[];this._onRowsRemoved($rows,reason);this._addNoDataRow()},_addNoDataRow:function(){if(this._$tableBody.find(">tr.jtable-no-data-row").length>0){return}let $tr=$("<tr></tr>").addClass("jtable-no-data-row").appendTo(this._$tableBody);let totalColumnCount=this._$table.find("thead th").length;$("<td></td>").attr("colspan",totalColumnCount).html(this.options.messages.noDataAvailable).appendTo($tr)},_removeNoDataRow:function(){this._$tableBody.find(".jtable-no-data-row").remove()},_refreshRowStyles:function(){for(let i=0;i<this._$tableRows.length;i++){if(i%2==0){this._$tableRows[i].addClass("jtable-row-even")}else{this._$tableRows[i].removeClass("jtable-row-even")}}},_getDisplayTextForRecordField:function(record,fieldName){let field=this.options.fields[fieldName];let fieldValue=record[fieldName];if(field.display){return field.display({record:record})}let extraFieldType=this._findItemByProperty(this._extraFieldTypes,"type",field.type);if(extraFieldType&&extraFieldType.creator){return extraFieldType.creator(record,field)}else if(field.type=="date"||field.type=="dateJS"){return this._getDisplayTextForDateRecordField(field,fieldValue)}else if(field.type=="checkbox"){return this._getCheckBoxTextForFieldByValue(fieldName,fieldValue)}else if(field.options){let options=this._getOptionsForField(fieldName,{record:record,value:fieldValue,source:"list",dependedValues:this._createDependedValuesUsingRecord(record,field.dependsOn)});return this._findOptionByValue(options,fieldValue).DisplayText}else{return fieldValue}},_createDependedValuesUsingRecord:function(record,dependsOn){if(!dependsOn){return{}}let dependedValues={};for(let i=0;i<dependsOn.length;i++){dependedValues[dependsOn[i]]=record[dependsOn[i]]}return dependedValues},_findOptionByValue:function(options,value){return this._findItemByProperty(options,"Value",value)},_findItemByProperty:function(items,key,value){for(let i=0;i<items.length;i++){if(items[i][key]==value){return items[i]}}return{}},_getDisplayTextForDateRecordField:function(field,fieldValue){if(!fieldValue){return""}if(typeof $.fn.datepicker=="function"){let displayFormat=field.displayFormat||this.options.defaultDateFormat;let date=this._parseDate(fieldValue);return $.datepicker.formatDate(displayFormat,date)}else{return fieldValue}},_getOptionsForField:function(fieldName,funcParams){let field=this.options.fields[fieldName];let optionsSource=field.options;if($.isFunction(optionsSource)){funcParams=$.extend(true,{_cacheCleared:false,dependedValues:{},clearCache:function(){this._cacheCleared=true}},funcParams);optionsSource=optionsSource(funcParams)}let options;if(typeof optionsSource=="string"){let cacheKey="options_"+fieldName+"_"+optionsSource;if(funcParams._cacheCleared||!this._cache[cacheKey]){this._cache[cacheKey]=this._buildOptionsFromArray(this._downloadOptions(fieldName,optionsSource));this._sortFieldOptions(this._cache[cacheKey],field.optionsSorting)}else{if(funcParams.value!=undefined){let optionForValue=this._findOptionByValue(this._cache[cacheKey],funcParams.value);if(optionForValue.DisplayText==undefined){this._cache[cacheKey]=this._buildOptionsFromArray(this._downloadOptions(fieldName,optionsSource));this._sortFieldOptions(this._cache[cacheKey],field.optionsSorting)}}}options=this._cache[cacheKey]}else if(jQuery.isArray(optionsSource)){options=this._buildOptionsFromArray(optionsSource);this._sortFieldOptions(options,field.optionsSorting)}else{options=this._buildOptionsArrayFromObject(optionsSource);this._sortFieldOptions(options,field.optionsSorting)}return options},_downloadOptions:function(fieldName,url){let self=this;let options=[];self._ajax({url:url,async:false,success:function(data){if(data.Result!="OK"){self._showError(data.Message);return}options=data.Options},error:function(){let errMessage=self._formatString(self.options.messages.cannotLoadOptionsFor,fieldName);self._showError(errMessage)}});return options},_sortFieldOptions:function(options,sorting){if(!options||!options.length||!sorting){return}let dataSelector;if(sorting.indexOf("value")==0){dataSelector=function(option){return option.Value}}else{dataSelector=function(option){return option.DisplayText}}let compareFunc;if($.type(dataSelector(options[0]))=="string"){compareFunc=function(option1,option2){return dataSelector(option1).localeCompare(dataSelector(option2))}}else{compareFunc=function(option1,option2){return dataSelector(option1)-dataSelector(option2)}}if(sorting.indexOf("desc")>0){options.sort(function(a,b){return compareFunc(b,a)})}else{options.sort(function(a,b){return compareFunc(a,b)})}},_buildOptionsArrayFromObject:function(options){let list=[];$.each(options,function(propName,propValue){list.push({Value:propName,DisplayText:propValue})});return list},_buildOptionsFromArray:function(optionsArray){let list=[];for(let i=0;i<optionsArray.length;i++){if($.isPlainObject(optionsArray[i])){list.push(optionsArray[i])}else{list.push({Value:optionsArray[i],DisplayText:optionsArray[i]})}}return list},_parseDate:function(dateString){if(dateString.indexOf("Date")>=0){return new Date(parseInt(dateString.substr(6),10))}else if(dateString.length==10){return new Date(parseInt(dateString.substr(0,4),10),parseInt(dateString.substr(5,2),10)-1,parseInt(dateString.substr(8,2),10))}else if(dateString.length==19){return new Date(parseInt(dateString.substr(0,4),10),parseInt(dateString.substr(5,2),10)-1,parseInt(dateString.substr(8,2),10),parseInt(dateString.substr(11,2),10),parseInt(dateString.substr(14,2),10),parseInt(dateString.substr(17,2),10))}else{this._logWarn("Given date is not properly formatted: "+dateString);return"format error!"}},_createToolBar:function(){this._$toolbarDiv=$("<div />").addClass("jtable-toolbar").appendTo(this._$titleDiv);for(let i=0;i<this.options.toolbar.items.length;i++){this._addToolBarItem(this.options.toolbar.items[i])}},_addToolBarItem:function(item){if(item==undefined||item.text==undefined&&item.icon==undefined){this._logWarn("Can not add tool bar item since it is not valid!");this._logWarn(item);return null}let $toolBarItem=$("<span></span>").addClass("jtable-toolbar-item").appendTo(this._$toolbarDiv);this._jqueryuiThemeAddClass($toolBarItem,"ui-widget ui-state-default ui-corner-all","ui-state-hover");if(item.cssClass){$toolBarItem.addClass(item.cssClass)}if(item.tooltip){$toolBarItem.attr("title",item.tooltip)}if(item.icon){let $icon=$('<span class="jtable-toolbar-item-icon"></span>').appendTo($toolBarItem);if(item.icon===true){}else if($.type(item.icon==="string")){$icon.css("background",'url("'+item.icon+'")')}}if(item.text){$('<span class=""></span>').html(item.text).addClass("jtable-toolbar-item-text").appendTo($toolBarItem)}if(item.click){$toolBarItem.click(function(e){e.preventDefault();e.stopPropagation();item.click()})}let hoverAnimationDuration=undefined;let hoverAnimationEasing=undefined;if(this.options.toolbar.hoverAnimation){hoverAnimationDuration=this.options.toolbar.hoverAnimationDuration;hoverAnimationEasing=this.options.toolbar.hoverAnimationEasing}$toolBarItem.hover(function(){$toolBarItem.addClass("jtable-toolbar-item-hover",hoverAnimationDuration,hoverAnimationEasing)},function(){$toolBarItem.removeClass("jtable-toolbar-item-hover",hoverAnimationDuration,hoverAnimationEasing)});return $toolBarItem},_showError:function(message){this._$errorDialog.find(".jtable-error-message").html(message);this._$errorDialog[0].showModal()},_setBusyTimer:null,_showBusy:function(message,delay){let self=this;let makeVisible=function(){self._$busyDialog.find(".jtable-busy-message").html(message);self._$busyDialog[0].showModal()};if(delay){if(self._setBusyTimer){return}self._setBusyTimer=setTimeout(makeVisible,delay)}else{makeVisible()}},_hideBusy:function(){clearTimeout(this._setBusyTimer);this._setBusyTimer=null;this._$busyDialog[0].close()},_isBusy:function(){return this._$busyDialog.is(":visible")},_jqueryuiThemeAddClass:function($elm,className,hoverClassName){if(!this.options.jqueryuiTheme){return}$elm.addClass(className);if(hoverClassName){$elm.hover(function(){$elm.addClass(hoverClassName)},function(){$elm.removeClass(hoverClassName)})}},_performAjaxCall:function(url,postData,async,success,error){this._ajax({url:url,data:postData,async:async,success:success,error:error})},_unAuthorizedRequestHandler:function(){if(this.options.unAuthorizedRequestRedirectUrl){location.href=this.options.unAuthorizedRequestRedirectUrl}else{location.reload(true)}},_ajax:function(options){let self=this;let opts={statusCode:{401:function(){self._unAuthorizedRequestHandler()}}};opts=$.extend(opts,this.options.ajaxSettings,options);opts.success=function(data){if(data&&data.UnAuthorizedRequest==true){self._unAuthorizedRequestHandler()}if(options.success){options.success(data)}};opts.error=function(jqXHR,textStatus,errorThrown){if(unloadingPage){jqXHR.abort();return}if(options.error){options.error(arguments)}};opts.complete=function(){if(options.complete){options.complete()}};$.ajax(opts)},_getKeyValueOfRecord:function(record){return record[this._keyField]},_setCookie:function(key,value){key=this._cookieKeyPrefix+key;let expireDate=new Date;expireDate.setDate(expireDate.getDate()+30);document.cookie=encodeURIComponent(key)+"="+encodeURIComponent(value)+"; expires="+expireDate.toUTCString()},_getCookie:function(key){key=this._cookieKeyPrefix+key;let equalities=document.cookie.split("; ");for(let i=0;i<equalities.length;i++){if(!equalities[i]){continue}let splitted=equalities[i].split("=");if(splitted.length!=2){continue}if(decodeURIComponent(splitted[0])===key){return decodeURIComponent(splitted[1]||"")}}return null},_generateCookieKeyPrefix:function(){let simpleHash=function(value){let hash=0;if(value.length==0){return hash}for(let i=0;i<value.length;i++){let ch=value.charCodeAt(i);hash=(hash<<5)-hash+ch;hash=hash&hash}return hash};let strToHash="";if(this.options.tableId){strToHash=strToHash+this.options.tableId+"#"}strToHash=strToHash+this._columnList.join("$")+"#c"+this._$table.find("thead th").length;return"jtable#"+simpleHash(strToHash)},_onLoadingRecords:function(){this._$mainContainer.trigger("loadingRecords",{})},_onRecordsLoaded:function(data){this._$mainContainer.trigger("recordsLoaded",{records:data.Records,serverResponse:data})},_onRowInserted:function($row,isNewRow){this._$mainContainer.trigger("rowInserted",{row:$row,record:$row.data("record"),isNewRow:isNewRow})},_onRowsRemoved:function($rows,reason){this._$mainContainer.trigger("rowsRemoved",{rows:$rows,reason:reason})},_onCloseRequested:function(){this._$mainContainer.trigger("closeRequested",{})}};$.fn.jtable=function(methodOrOptions){let options={};let methodOrOptionsType=typeof methodOrOptions;if(methodOrOptionsType==="string"){if(methodOrOptions.startsWith("_")){methodOrOptions="load"}else{options=Array.prototype.slice.call(arguments,1)}}else{options=methodOrOptions}let res;this.each(function(){let myinstance=$.data(this,"jTable");if(!myinstance){if(methodOrOptionsType!=="object"){methodOrOptions={}}res=$.data(this,"jTable",new jTable(this,methodOrOptions))}else{if(methodOrOptionsType==="string"){if(myinstance&&typeof myinstance[methodOrOptions]==="function"){res=myinstance[methodOrOptions].apply(myinstance,options)}else{res=$.error("Method "+methodOrOptions+" does not exist on jtable")}}else{res=$.error("Incorrect call to jtable")}}return});return res}})(jQuery);(function($){$.extend(true,jTable.prototype,{_getPropertyOfObject:function(obj,propName){if(propName.indexOf(".")<0){return obj[propName]}else{let preDot=propName.substring(0,propName.indexOf("."));let postDot=propName.substring(propName.indexOf(".")+1);return this._getPropertyOfObject(obj[preDot],postDot)}},_setPropertyOfObject:function(obj,propName,value){if(propName.indexOf(".")<0){obj[propName]=value}else{let preDot=propName.substring(0,propName.indexOf("."));let postDot=propName.substring(propName.indexOf(".")+1);this._setPropertyOfObject(obj[preDot],postDot,value)}},_insertToArrayIfDoesNotExists:function(array,value){if($.inArray(value,array)<0){array.push(value)}},_findIndexInArray:function(value,array,compareFunc){if(!compareFunc){compareFunc=function(a,b){return a==b}}for(let i=0;i<array.length;i++){if(compareFunc(value,array[i])){return i}}return-1},_normalizeNumber:function(number,min,max,defaultValue){if(number==undefined||number==null||isNaN(number)){return defaultValue}if(number<min){return min}if(number>max){return max}return number},_formatString:function(){if(arguments.length==0){return null}let str=arguments[0];for(let i=1;i<arguments.length;i++){let placeHolder="{"+(i-1)+"}";str=str.replace(placeHolder,arguments[i])}return str},_isDeferredObject:function(obj){return obj.then&&obj.done&&obj.fail},_logDebug:function(text){if(!window.console){return}console.log("jTable DEBUG: "+text)},_logInfo:function(text){if(!window.console){return}console.log("jTable INFO: "+text)},_logWarn:function(text){if(!window.console){return}console.log("jTable WARNING: "+text)},_logError:function(text){if(!window.console){return}console.log("jTable ERROR: "+text)}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){let len=this.length;let from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)return from}return-1}}})(jQuery);(function($){$.extend(true,jTable.prototype,{_submitFormUsingAjax:function(url,formData,success,error){this._ajax({url:url,data:formData,success:success,error:error})},_createInputLabelForRecordField:function(fieldName){return $("<div />").addClass("jtable-input-label").html(this.options.fields[fieldName].inputTitle||this.options.fields[fieldName].title)},_createInputForRecordField:function(funcParams){let fieldName=funcParams.fieldName,value=funcParams.value,record=funcParams.record,formType=funcParams.formType,form=funcParams.form;let field=this.options.fields[fieldName];if(value==undefined||value==null){value=field.defaultValue}if(field.input){let $input=$(field.input({value:value,record:record,formType:formType,form:form}));if(!$input.attr("id")){$input.attr("id","Edit-"+fieldName)}return $("<div />").addClass("jtable-input jtable-custom-input").append($input)}if(field.type=="date"){return this._createDateInputForField(field,fieldName,value)}else if(field.type=="textarea"){return this._createTextAreaForField(field,fieldName,value)}else if(field.type=="checkbox"){return this._createCheckboxForField(field,fieldName,value)}else if(field.options){if(field.type=="radiobutton"){return this._createRadioButtonListForField(field,fieldName,value,record,formType)}else{return this._createDropDownListForField(field,fieldName,value,record,formType,form)}}else{return this._createInputForField(field,fieldName,value)}},_createInputForHidden:function(fieldName,value){if(value==undefined){value=""}return $('<input type="hidden" name="'+fieldName+'" id="Edit-'+fieldName+'"></input>').val(value)},_createDateInputForField:function(field,fieldName,value){let $input="";if(typeof $.fn.datepicker=="function"){let displayFormat=field.displayFormat||this.options.defaultDateFormat;$input=$('<input class="'+field.inputClass+'" id="Edit-'+fieldName+'" type="text" name="'+fieldName+'"></input>');$input.datepicker({dateFormat:displayFormat})}else{$input=$('<input class="'+field.inputClass+'" id="Edit-'+fieldName+'" type="date" name="'+fieldName+'"></input>')}if(value!=undefined){$input.val(value)}return $("<div />").addClass("jtable-input jtable-date-input").append($input)},_createTextAreaForField:function(field,fieldName,value){let $textArea=$('<textarea class="'+field.inputClass+'" id="Edit-'+fieldName+'" name="'+fieldName+'"></textarea>');if(value!=undefined){$textArea.val(value)}return $("<div />").addClass("jtable-input jtable-textarea-input").append($textArea)},_createInputForField:function(field,fieldName,value){let $input=$('<input class="'+field.inputClass+'" placeholder="'+field.placeholder+'" id="Edit-'+fieldName+'" type="'+field.type+'" name="'+fieldName+'"></input>');if(value!=undefined){$input.val(value)}return $("<div />").addClass("jtable-input jtable-"+field.inputClass+"-input").append($input)},_createCheckboxForField:function(field,fieldName,value){let self=this;if(value==undefined){value=self._getCheckBoxPropertiesForFieldByState(fieldName,false).Value}let $containerDiv=$("<div />").addClass("jtable-input jtable-checkbox-input");let $checkBox=$('<input class="'+field.inputClass+'" id="Edit-'+fieldName+'" type="checkbox" name="'+fieldName+'" />').appendTo($containerDiv);if(value!=undefined){$checkBox.val(value)}let $textSpan=$("<span>"+(field.formText||self._getCheckBoxTextForFieldByValue(fieldName,value))+"</span>").appendTo($containerDiv);if(self._getIsCheckBoxSelectedForFieldByValue(fieldName,value)){$checkBox.attr("checked","checked")}let refreshCheckBoxValueAndText=function(){let checkboxProps=self._getCheckBoxPropertiesForFieldByState(fieldName,$checkBox.is(":checked"));$checkBox.attr("value",checkboxProps.Value);$textSpan.html(field.formText||checkboxProps.DisplayText)};$checkBox.click(function(){refreshCheckBoxValueAndText()});if(field.setOnTextClick!=false){$textSpan.addClass("jtable-option-text-clickable").click(function(){if($checkBox.is(":checked")){$checkBox.attr("checked",false)}else{$checkBox.attr("checked",true)}refreshCheckBoxValueAndText()})}return $containerDiv},_createDropDownListForField:function(field,fieldName,value,record,source,form){let $containerDiv=$("<div />").addClass("jtable-input jtable-dropdown-input");let $select=$('<select class="'+field.inputClass+'" id="Edit-'+fieldName+'" name="'+fieldName+'"></select>').appendTo($containerDiv);let options=this._getOptionsForField(fieldName,{record:record,source:source,form:form,dependedValues:this._createDependedValuesUsingForm(form,field.dependsOn)});this._fillDropDownListWithOptions($select,options,value);return $containerDiv},_fillDropDownListWithOptions:function($select,options,value){$select.empty();for(let i=0;i<options.length;i++){$("<option"+(options[i].Value==value?' selected="selected"':"")+">"+options[i].DisplayText+"</option>").val(options[i].Value).appendTo($select)}},_createDependedValuesUsingForm:function($form,dependsOn){if(!dependsOn){return{}}let dependedValues={};for(let i=0;i<dependsOn.length;i++){let dependedField=dependsOn[i];let $dependsOn=$form.find("select[name="+dependedField+"]");if($dependsOn.length<=0){continue}dependedValues[dependedField]=$dependsOn.val()}return dependedValues},_createRadioButtonListForField:function(field,fieldName,value,record,source){let $containerDiv=$("<div />").addClass("jtable-input jtable-radiobuttonlist-input");let options=this._getOptionsForField(fieldName,{record:record,source:source});$.each(options,function(i,option){let $radioButtonDiv=$('<div class=""></div>').addClass("jtable-radio-input").appendTo($containerDiv);let $radioButton=$('<input type="radio" id="Edit-'+fieldName+"-"+i+'" class="'+field.inputClass+'" name="'+fieldName+'"'+(option.Value==value+""?' checked="true"':"")+" />").val(option.Value).appendTo($radioButtonDiv);let $textSpan=$("<span></span>").html(option.DisplayText).appendTo($radioButtonDiv);if(field.setOnTextClick!=false){$textSpan.addClass("jtable-option-text-clickable").click(function(){if(!$radioButton.is(":checked")){$radioButton.attr("checked",true)}})}});return $containerDiv},_getCheckBoxTextForFieldByValue:function(fieldName,value){return this.options.fields[fieldName].values[value]},_getIsCheckBoxSelectedForFieldByValue:function(fieldName,value){return this._createCheckBoxStateArrayForFieldWithCaching(fieldName)[1].Value.toString()==value.toString()},_getCheckBoxPropertiesForFieldByState:function(fieldName,checked){return this._createCheckBoxStateArrayForFieldWithCaching(fieldName)[checked?1:0]},_createCheckBoxStateArrayForFieldWithCaching:function(fieldName){let cacheKey="checkbox_"+fieldName;if(!this._cache[cacheKey]){this._cache[cacheKey]=this._createCheckBoxStateArrayForField(fieldName)}return this._cache[cacheKey]},_createCheckBoxStateArrayForField:function(fieldName){let stateArray=[];let currentIndex=0;$.each(this.options.fields[fieldName].values,function(propName,propValue){if(currentIndex++<2){stateArray.push({Value:propName,DisplayText:propValue})}});return stateArray},_makeCascadeDropDowns:function($form,record,source){let self=this;$form.find("select").each(function(){let $thisDropdown=$(this);let fieldName=$thisDropdown.attr("name");if(!fieldName){return}let field=self.options.fields[fieldName];if(!field.dependsOn){return}$.each(field.dependsOn,function(index,dependsOnField){let $dependsOnDropdown=$form.find("select[name="+dependsOnField+"]");$dependsOnDropdown.change(function(){let funcParams={record:record,source:source,form:$form,dependedValues:{}};funcParams.dependedValues=self._createDependedValuesUsingForm($form,field.dependsOn);let options=self._getOptionsForField(fieldName,funcParams);self._fillDropDownListWithOptions($thisDropdown,options,undefined);$thisDropdown.change()})})})},_updateRecordValuesFromForm:function(record,$form){for(let i=0;i<this._fieldList.length;i++){let fieldName=this._fieldList[i];let field=this.options.fields[fieldName];if(field.edit==false){continue}let $inputElement=$form.find('[name="'+fieldName+'"]');if($inputElement.length<=0){continue}if(field.type=="date"){let dateVal=$inputElement.val();if(dateVal){let displayFormat=field.displayFormat||this.options.defaultDateFormat;if(typeof $.fn.datepicker=="function"){try{let date=$.datepicker.parseDate(displayFormat,dateVal);record[fieldName]="/Date("+date.getTime()+")/"}catch(e){this._logWarn("Date format is incorrect for field "+fieldName+": "+dateVal);record[fieldName]=undefined}}else{record[fieldName]=$inputElement.val()}}else{this._logDebug("Date is empty for "+fieldName);record[fieldName]=undefined}}else if(field.options&&field.type=="radiobutton"){let $checkedElement=$inputElement.filter(":checked");if($checkedElement.length){record[fieldName]=$checkedElement.val()}else{record[fieldName]=undefined}}else{record[fieldName]=$inputElement.val()}}},_setEnabledOfDialogButton:function($button,enabled,buttonText){if(!$button){return}if(enabled!=false){$button.removeAttr("disabled");if(this.options.jqueryuiTheme){$button.removeClass("ui-state-disabled")}}else{$button.attr("disabled","disabled");if(this.options.jqueryuiTheme){$button.addClass("ui-state-disabled")}}if(buttonText){$button.find("span").text(buttonText)}}})})(jQuery);(function($){let base={_create:jTable.prototype._create};$.extend(true,jTable.prototype,{options:{recordAdded:function(event,data){},messages:{addNewRecord:"Add new record"}},_$addRecordDialog:null,_create:function(){base._create.apply(this,arguments);if(!this.options.actions.createAction){return}this._createAddRecordDialog()},_createAddRecordDialog:function(){let self=this;self._$addRecordDialog=$("<dialog />").addClass("jtable-modal-dialog").appendTo(self._$mainContainer);self._$addRecordDialog.on("close",function(){let $addRecordForm=self._$addRecordDialog.find("form").first();self._$mainContainer.trigger("formClosed",{form:$addRecordForm,formType:"create"});$addRecordForm.remove()});$('<h2 id="addRecordDialogTitle"></h2>').css({padding:"0px"}).text(self.options.messages.addNewRecord).appendTo(self._$addRecordDialog);const $cancelButton=$('<button class="jtable-dialog-button jtable-dialog-cancelbutton"></button> ').attr("id","AddRecordDialogCancelButton").html("<span>"+self.options.messages.cancel+"</span>").on("click",function(){self._closeCreateForm()});let $saveButton=$('<button class="jtable-dialog-button jtable-dialog-savebutton"></button>').attr("id","AddRecordDialogSaveButton").html("<span>"+self.options.messages.save+"</span>").on("click",function(){self._onSaveClickedOnCreateForm();self._closeCreateForm()});self._$addRecordDialog.append($cancelButton,$saveButton);if(self.options.addRecordButton){self.options.addRecordButton.click(function(e){e.preventDefault();self._showAddRecordForm()})}else{self._addToolBarItem({icon:true,cssClass:"jtable-toolbar-item-add-record",text:self.options.messages.addNewRecord,click:function(){self._showAddRecordForm()}})}},_onSaveClickedOnCreateForm:function(){let self=this;let $saveButton=self._$addRecordDialog.find("#AddRecordDialogSaveButton");let $addRecordForm=self._$addRecordDialog.find("form");if(self._$mainContainer.trigger("formSubmitting",{form:$addRecordForm,formType:"create"})!=false){self._setEnabledOfDialogButton($saveButton,false,self.options.messages.saving);self._saveAddRecordForm($addRecordForm,$saveButton)}},_closeCreateForm:function(){this._$addRecordDialog[0].close()},showCreateForm:function(){this._showAddRecordForm()},addRecord:function(options){let self=this;options=$.extend({clientOnly:false,animationsEnabled:self.options.animationsEnabled,success:function(){},error:function(){}},options);if(!options.record){self._logWarn("options parameter in addRecord method must contain a record property.");return}if(options.clientOnly){self._addRow(self._createRowFromRecord(options.record),{isNewRow:true,animationsEnabled:options.animationsEnabled});options.success();return}let completeAddRecord=function(data){if(data.Result!="OK"){self._showError(data.Message);options.error(data);return}if(!data.Record){self._logError("Server must return the created Record object.");options.error(data);return}self._onRecordAdded(data);self._addRow(self._createRowFromRecord(data.Record),{isNewRow:true,animationsEnabled:options.animationsEnabled});options.success(data)};if(!options.url&&$.isFunction(self.options.actions.createAction)){let funcResult=self.options.actions.createAction($.param(options.record));if(self._isDeferredObject(funcResult)){funcResult.done(function(data){completeAddRecord(data)}).fail(function(){self._showError(self.options.messages.serverCommunicationError);options.error()})}else{completeAddRecord(funcResult)}}else{self._submitFormUsingAjax(options.url||self.options.actions.createAction,$.param(options.record),function(data){completeAddRecord(data)},function(){self._showError(self.options.messages.serverCommunicationError);options.error()})}},_showAddRecordForm:function(){let self=this;let $addRecordForm=$('<form id="jtable-create-form" class="jtable-dialog-form jtable-create-form"></form>');for(let i=0;i<self._fieldList.length;i++){let fieldName=self._fieldList[i];let field=self.options.fields[fieldName];if(field.key==true&&field.create!=true){continue}if(field.create==false){continue}if(field.type=="hidden"){$addRecordForm.append(self._createInputForHidden(fieldName,field.defaultValue));continue}let $fieldContainer=$("<div />").addClass("jtable-input-field-container").appendTo($addRecordForm);$fieldContainer.append(self._createInputLabelForRecordField(fieldName));$fieldContainer.append(self._createInputForRecordField({fieldName:fieldName,formType:"create",form:$addRecordForm}))}self._makeCascadeDropDowns($addRecordForm,undefined,"create");$addRecordForm.submit(function(){self._onSaveClickedOnCreateForm();return false});self._$addRecordDialog.find("form:first").remove();let $saveButton=self._$editRecordDialog.find("#EditDialogSaveButton");self._setEnabledOfDialogButton($saveButton,true,self.options.messages.save);self._$addRecordDialog.find("#addRecordDialogTitle:first").after($addRecordForm);self._$addRecordDialog[0].showModal();self._$mainContainer.trigger("formCreated",{form:$addRecordForm,formType:"create"})},_saveAddRecordForm:function($addRecordForm,$saveButton){let self=this;let completeAddRecord=function(data){if(data.Result!="OK"){self._showError(data.Message);return}if(!data.Record){self._logError("Server must return the created Record object.");return}self._onRecordAdded(data);self._addRow(self._createRowFromRecord(data.Record),{isNewRow:true});self._closeCreateForm()};if($.isFunction(self.options.actions.createAction)){let funcResult=self.options.actions.createAction($addRecordForm.serialize());if(self._isDeferredObject(funcResult)){funcResult.done(function(data){completeAddRecord(data)}).fail(function(){self._showError(self.options.messages.serverCommunicationError)})}else{completeAddRecord(funcResult)}}else{self._submitFormUsingAjax(self.options.actions.createAction,$addRecordForm.serialize(),function(data){completeAddRecord(data)},function(){self._showError(self.options.messages.serverCommunicationError)})}},_onRecordAdded:function(data){this._$mainContainer.trigger("recordAdded",{record:data.Record,serverResponse:data})}})})(jQuery);(function($){let base={_create:jTable.prototype._create,_addColumnsToHeaderRow:jTable.prototype._addColumnsToHeaderRow,_addCellsToRowUsingRecord:jTable.prototype._addCellsToRowUsingRecord};$.extend(true,jTable.prototype,{options:{recordUpdated:function(event,data){},rowUpdated:function(event,data){},messages:{editRecord:"Edit Record"}},_$editRecordDialog:null,_$editingRow:null,_create:function(){base._create.apply(this,arguments);if(!this.options.actions.updateAction){return}this._createEditDialog()},_createEditDialog:function(){let self=this;self._$editRecordDialog=$("<dialog />").addClass("jtable-modal-dialog").appendTo(self._$mainContainer);self._$editRecordDialog.on("close",function(){let $editForm=self._$editRecordDialog.find("form:first");self._$mainContainer.trigger("formClosed",{form:$editForm,formType:"edit",row:self._$editingRow});$editForm.remove()});$('<h2 id="editDialogTitle"></h2>').css({padding:"0px"}).text(self.options.messages.editRecord).appendTo(self._$editRecordDialog);const $cancelButton=$('<button class="jtable-dialog-button jtable-dialog-cancelbutton"></button> ').attr("id","EditRecordDialogCancelButton").html("<span>"+self.options.messages.cancel+"</span>").on("click",function(){self._closeEditForm()});let $saveButton=$('<button class="jtable-dialog-button jtable-dialog-savebutton"></button>').attr("id","EditDialogSaveButton").html("<span>"+self.options.messages.save+"</span>").on("click",function(){self._onSaveClickedOnEditForm();self._closeEditForm()});self._$editRecordDialog.append($cancelButton,$saveButton)},_onSaveClickedOnEditForm:function(){let self=this;if(self._$editingRow.hasClass("jtable-row-removed")){self._closeEditForm();return}let $saveButton=self._$editRecordDialog.find("#EditDialogSaveButton");let $editForm=self._$editRecordDialog.find("form");if(self._$mainContainer.trigger("formSubmitting",{form:$editForm,formType:"edit",row:self._$editingRow})!=false){self._setEnabledOfDialogButton($saveButton,false,self.options.messages.saving);self._saveEditForm($editForm,$saveButton)}},_closeEditForm:function(){this._$editRecordDialog[0].close()},updateRecord:function(options){let self=this;options=$.extend({clientOnly:false,animationsEnabled:self.options.animationsEnabled,success:function(){},error:function(){}},options);if(!options.record){self._logWarn("options parameter in updateRecord method must contain a record property.");return}let key=self._getKeyValueOfRecord(options.record);if(key==undefined||key==null){self._logWarn("options parameter in updateRecord method must contain a record that contains the key field property.");return}let $updatingRow=self.getRowByKey(key);if($updatingRow==null){self._logWarn('Can not found any row by key "'+key+'" on the table. Updating row must be visible on the table.');return}if(options.clientOnly){$.extend($updatingRow.data("record"),options.record);self._updateRowTexts($updatingRow);self._onRecordUpdated($updatingRow,null);if(options.animationsEnabled){self._showUpdateAnimationForRow($updatingRow)}options.success();return}let completeEdit=function(data){if(data.Result!="OK"){self._showError(data.Message);options.error(data);return}$.extend($updatingRow.data("record"),options.record);self._updateRecordValuesFromServerResponse($updatingRow.data("record"),data);self._updateRowTexts($updatingRow);self._onRecordUpdated($updatingRow,data);if(options.animationsEnabled){self._showUpdateAnimationForRow($updatingRow)}options.success(data)};if(!options.url&&$.isFunction(self.options.actions.updateAction)){let funcResult=self.options.actions.updateAction($.param(options.record));if(self._isDeferredObject(funcResult)){funcResult.done(function(data){completeEdit(data)}).fail(function(){self._showError(self.options.messages.serverCommunicationError);options.error()})}else{completeEdit(funcResult)}}else{self._submitFormUsingAjax(options.url||self.options.actions.updateAction,$.param(options.record),function(data){completeEdit(data)},function(){self._showError(self.options.messages.serverCommunicationError);options.error()})}},_addColumnsToHeaderRow:function($tr){base._addColumnsToHeaderRow.apply(this,arguments);if(this.options.actions.updateAction!=undefined){$tr.append(this._createEmptyCommandHeader("jtable-column-header-edit"))}},_addCellsToRowUsingRecord:function($row){let self=this;base._addCellsToRowUsingRecord.apply(this,arguments);if(self.options.actions.updateAction!=undefined){let $span=$("<span></span>").html(self.options.messages.editRecord);let $button=$('<button title="'+self.options.messages.editRecord+'"></button>').addClass("jtable-command-button jtable-edit-command-button").append($span).click(function(e){e.preventDefault();e.stopPropagation();self._showEditForm($row)});$("<td></td>").addClass("jtable-command-column").append($button).appendTo($row)}},_showEditForm:function($tableRow){let self=this;let record=$tableRow.data("record");let $editForm=$('<form id="jtable-edit-form" class="jtable-dialog-form jtable-edit-form"></form>');for(let i=0;i<self._fieldList.length;i++){let fieldName=self._fieldList[i];let field=self.options.fields[fieldName];let fieldValue=record[fieldName];if(field.key==true){if(field.edit!=true){$editForm.append(self._createInputForHidden(fieldName,fieldValue));continue}else{$editForm.append(self._createInputForHidden("jtRecordKey",fieldValue))}}if(field.edit==false){continue}if(field.type=="hidden"){$editForm.append(self._createInputForHidden(fieldName,fieldValue));continue}let $fieldContainer=$('<div class="jtable-input-field-container"></div>').appendTo($editForm);$fieldContainer.append(self._createInputLabelForRecordField(fieldName));let currentValue=self._getValueForRecordField(record,fieldName);$fieldContainer.append(self._createInputForRecordField({fieldName:fieldName,value:currentValue,record:record,formType:"edit",form:$editForm}))}self._makeCascadeDropDowns($editForm,record,"edit");$editForm.submit(function(){self._onSaveClickedOnEditForm();return false});self._$editingRow=$tableRow;self._$editRecordDialog.find("form:first").remove();let $saveButton=self._$editRecordDialog.find("#EditDialogSaveButton");self._setEnabledOfDialogButton($saveButton,true,self.options.messages.save);self._$editRecordDialog.find("#editDialogTitle:first").after($editForm);self._$editRecordDialog[0].showModal();self._$mainContainer.trigger("formCreated",{form:$editForm,formType:"edit",record:record,row:$tableRow})},_saveEditForm:function($editForm,$saveButton){let self=this;let completeEdit=function(data){if(data.Result!="OK"){self._showError(data.Message);return}let record=self._$editingRow.data("record");self._updateRecordValuesFromForm(record,$editForm);self._updateRecordValuesFromServerResponse(record,data);self._updateRowTexts(self._$editingRow);self._$editingRow.attr("data-record-key",self._getKeyValueOfRecord(record));self._onRecordUpdated(self._$editingRow,data);if(self.options.animationsEnabled){self._showUpdateAnimationForRow(self._$editingRow)}self._closeEditForm()};if($.isFunction(self.options.actions.updateAction)){let funcResult=self.options.actions.updateAction($editForm.serialize());if(self._isDeferredObject(funcResult)){funcResult.done(function(data){completeEdit(data)}).fail(function(){self._showError(self.options.messages.serverCommunicationError)})}else{completeEdit(funcResult)}}else{self._submitFormUsingAjax(self.options.actions.updateAction,$editForm.serialize(),function(data){completeEdit(data)},function(){self._showError(self.options.messages.serverCommunicationError)})}},_updateRecordValuesFromServerResponse:function(record,serverResponse){if(!serverResponse||!serverResponse.Record){return}$.extend(true,record,serverResponse.Record)},_getValueForRecordField:function(record,fieldName){let field=this.options.fields[fieldName];let fieldValue=record[fieldName];if(field.type=="date"){return this._getDisplayTextForDateRecordField(field,fieldValue)}else{return fieldValue}},_updateRowTexts:function($tableRow){let record=$tableRow.data("record");let $columns=$tableRow.find("td");for(let i=0;i<this._columnList.length;i++){let displayItem=this._getDisplayTextForRecordField(record,this._columnList[i]);if(displayItem===0)displayItem="0";$columns.eq(this._firstDataColumnOffset+i).html(displayItem||"")}this._onRowUpdated($tableRow)},_showUpdateAnimationForRow:function($tableRow){let className="jtable-row-updated";if(this.options.jqueryuiTheme){className=className+" ui-state-highlight"}$tableRow.stop(true,true).addClass(className,"slow","",function(){$tableRow.removeClass(className,5e3)})},_onRowUpdated:function($row){this._$mainContainer.trigger("rowUpdated",{row:$row,record:$row.data("record")})},_onRecordUpdated:function($row,data){this._$mainContainer.trigger("recordUpdated",{record:$row.data("record"),row:$row,serverResponse:data})}})})(jQuery);(function($){let base={_create:jTable.prototype._create,_addColumnsToHeaderRow:jTable.prototype._addColumnsToHeaderRow,_addCellsToRowUsingRecord:jTable.prototype._addCellsToRowUsingRecord};$.extend(true,jTable.prototype,{options:{deleteConfirmation:true,recordDeleted:function(event,data){},messages:{deleteConfirmation:"This record will be deleted. Are you sure?",deleteText:"Delete",deleting:"Deleting",canNotDeletedRecords:"Can not delete {0} of {1} records!",deleteProggress:"Deleting {0} of {1} records, processing..."}},_$deleteDialog:null,_$deletingRow:null,_create:function(){base._create.apply(this,arguments);this._createDeleteDialog()},_createDeleteDialog:function(){let self=this;if(!self.options.actions.deleteAction){return}self._$deleteDialog=$("<dialog />").addClass("jtable-modal-dialog").appendTo(self._$mainContainer);$('<h2 id="deleteDialogTitle"></h2>').css({padding:"0px"}).text(self.options.messages.areYouSure).appendTo(self._$deleteDialog);$('<div><p><span class="alert-icon" style="float:left; margin:0 7px 20px 0;"></span><span class="jtable-delete-confirm-message"></span></p></div>').appendTo(self._$deleteDialog);const $cancelButton=$('<button class="jtable-dialog-button jtable-dialog-cancelbutton"></button> ').attr("id","DeleteDialogCancelButton").html("<span>"+self.options.messages.cancel+"</span>").on("click",function(){self._closeDeleteDialog()});let $deleteButton=$('<button class="jtable-dialog-button jtable-dialog-deletebutton"></button>').attr("id","DeleteDialogDeleteButton").html("<span>"+self.options.messages.deleteText+"</span>").on("click",function(){if(self._$deletingRow.hasClass("jtable-row-removed")){self._closeDeleteDialog();return}self._setEnabledOfDialogButton($deleteButton,false,self.options.messages.deleting);self._deleteRecordFromServer(self._$deletingRow,function(){self._removeRowsFromTableWithAnimation(self._$deletingRow);self._closeDeleteDialog()},function(message){self._showError(message)})});self._$deleteDialog.append($cancelButton,$deleteButton)},_closeDeleteDialog:function(){this._$deleteDialog[0].close()},deleteRows:function($rows){let self=this;if($rows.length<=0){self._logWarn("No rows specified to jTable deleteRows method.");return}if(self._isBusy()){self._logWarn("Can not delete rows since jTable is busy!");return}if($rows.length==1){self._deleteRecordFromServer($rows,function(){self._removeRowsFromTableWithAnimation($rows)},function(message){self._showError(message)});return}self._showBusy(self._formatString(self.options.messages.deleteProggress,0,$rows.length));let completedCount=0;let isCompleted=function(){return completedCount>=$rows.length};let completed=function(){let $deletedRows=$rows.filter(".jtable-row-ready-to-remove");if($deletedRows.length<$rows.length){self._showError(self._formatString(self.options.messages.canNotDeletedRecords,$rows.length-$deletedRows.length,$rows.length))}if($deletedRows.length>0){self._removeRowsFromTableWithAnimation($deletedRows)}self._hideBusy()};let deletedCount=0;$rows.each(function(){let $row=$(this);self._deleteRecordFromServer($row,function(){++deletedCount;++completedCount;$row.addClass("jtable-row-ready-to-remove");self._showBusy(self._formatString(self.options.messages.deleteProggress,deletedCount,$rows.length));if(isCompleted()){completed()}},function(){++completedCount;if(isCompleted()){completed()}})})},deleteRecord:function(options){let self=this;options=$.extend({clientOnly:false,animationsEnabled:self.options.animationsEnabled,url:self.options.actions.deleteAction,success:function(){},error:function(){}},options);if(options.key==undefined){self._logWarn("options parameter in deleteRecord method must contain a key property.");return}let $deletingRow=self.getRowByKey(options.key);if($deletingRow==null){self._logWarn("Can not found any row by key: "+options.key);return}if(options.clientOnly){self._removeRowsFromTableWithAnimation($deletingRow,options.animationsEnabled);options.success();return}self._deleteRecordFromServer($deletingRow,function(data){self._removeRowsFromTableWithAnimation($deletingRow,options.animationsEnabled);options.success(data)},function(message){self._showError(message);options.error(message)},options.url)},_addColumnsToHeaderRow:function($tr){base._addColumnsToHeaderRow.apply(this,arguments);if(this.options.actions.deleteAction!=undefined){$tr.append(this._createEmptyCommandHeader("jtable-column-header-delete"))}},_addCellsToRowUsingRecord:function($row){base._addCellsToRowUsingRecord.apply(this,arguments);let self=this;if(self.options.actions.deleteAction!=undefined){let $span=$("<span></span>").html(self.options.messages.deleteText);let $button=$('<button title="'+self.options.messages.deleteText+'"></button>').addClass("jtable-command-button jtable-delete-command-button").append($span).click(function(e){e.preventDefault();e.stopPropagation();self._deleteButtonClickedForRow($row)});$("<td></td>").addClass("jtable-command-column").append($button).appendTo($row)}},_deleteButtonClickedForRow:function($row){let self=this;let deleteConfirm;let deleteConfirmMessage=self.options.messages.deleteConfirmation;if($.isFunction(self.options.deleteConfirmation)){let data={row:$row,record:$row.data("record"),deleteConfirm:true,deleteConfirmMessage:deleteConfirmMessage,cancel:false,cancelMessage:null};self.options.deleteConfirmation(data);if(data.cancel){if(data.cancelMessage){self._showError(data.cancelMessage)}return}deleteConfirmMessage=data.deleteConfirmMessage;deleteConfirm=data.deleteConfirm}else{deleteConfirm=self.options.deleteConfirmation}if(deleteConfirm!=false){self._showDeleteDialog($row,deleteConfirmMessage)}else{self._deleteRecordFromServer($row,function(){self._removeRowsFromTableWithAnimation($row)},function(message){self._showError(message)})}},_showDeleteDialog:function($row,deleteConfirmMessage){this._$deletingRow=$row;this._$deleteDialog.find(".jtable-delete-confirm-message").html(deleteConfirmMessage);let $deleteButton=this._$deleteDialog.find("#DeleteDialogDeleteButton");this._setEnabledOfDialogButton($deleteButton,true,this.options.messages.deleteText);this._$deleteDialog[0].showModal()},_deleteRecordFromServer:function($row,success,error,url){let self=this;let completeDelete=function(data){if(data.Result!="OK"){$row.data("deleting",false);if(error){error(data.Message)}return}self._$mainContainer.trigger("recordDeleted",{record:$row.data("record"),row:$row,serverResponse:data});if(success){success(data)}};if($row.data("deleting")==true){return}$row.data("deleting",true);let postData={};postData[self._keyField]=self._getKeyValueOfRecord($row.data("record"));if(!url&&$.isFunction(self.options.actions.deleteAction)){let funcResult=self.options.actions.deleteAction(postData);if(self._isDeferredObject(funcResult)){funcResult.done(function(data){completeDelete(data)}).fail(function(){$row.data("deleting",false);if(error){error(self.options.messages.serverCommunicationError)}})}else{completeDelete(funcResult)}}else{this._ajax({url:url||self.options.actions.deleteAction,data:postData,success:function(data){completeDelete(data)},error:function(){$row.data("deleting",false);if(error){error(self.options.messages.serverCommunicationError)}}})}},_removeRowsFromTableWithAnimation:function($rows,animationsEnabled){let self=this;if(animationsEnabled==undefined){animationsEnabled=self.options.animationsEnabled}if(animationsEnabled){let className="jtable-row-deleting";if(this.options.jqueryuiTheme){className=className+" ui-state-disabled"}$rows.stop(true,true).addClass(className,"slow","").promise().done(function(){self._removeRowsFromTable($rows,"deleted")})}else{self._removeRowsFromTable($rows,"deleted")}}})})(jQuery);(function($){let base={_create:jTable.prototype._create,_addColumnsToHeaderRow:jTable.prototype._addColumnsToHeaderRow,_addCellsToRowUsingRecord:jTable.prototype._addCellsToRowUsingRecord,_onLoadingRecords:jTable.prototype._onLoadingRecords,_onRecordsLoaded:jTable.prototype._onRecordsLoaded,_onRowsRemoved:jTable.prototype._onRowsRemoved};$.extend(true,jTable.prototype,{options:{selecting:false,multiselect:false,selectingCheckboxes:false,selectOnRowClick:true,selectionChanged:function(event,data){}},_selectedRecordIdsBeforeLoad:null,_$selectAllCheckbox:null,_shiftKeyDown:false,_create:function(){if(this.options.selecting&&this.options.selectingCheckboxes){++this._firstDataColumnOffset;this._bindKeyboardEvents()}base._create.apply(this,arguments)},_bindKeyboardEvents:function(){let self=this;$(document).keydown(function(event){switch(event.which){case 16:self._shiftKeyDown=true;break}}).keyup(function(event){switch(event.which){case 16:self._shiftKeyDown=false;break}})},selectedRows:function(){return this._getSelectedRows()},selectRows:function($rows){this._selectRows($rows);this._onSelectionChanged()},_addColumnsToHeaderRow:function($tr){if(this.options.selecting&&this.options.selectingCheckboxes){if(this.options.multiselect){$tr.append(this._createSelectAllHeader())}else{$tr.append(this._createEmptyCommandHeader())}}base._addColumnsToHeaderRow.apply(this,arguments)},_addCellsToRowUsingRecord:function($row){if(this.options.selecting){this._makeRowSelectable($row)}base._addCellsToRowUsingRecord.apply(this,arguments)},_onLoadingRecords:function(){if(this.options.selecting){this._storeSelectionList()}base._onLoadingRecords.apply(this,arguments)},_onRecordsLoaded:function(){if(this.options.selecting){this._restoreSelectionList()}base._onRecordsLoaded.apply(this,arguments)},_onRowsRemoved:function($rows,reason){if(this.options.selecting&&reason!="reloading"&&$rows.filter(".jtable-row-selected").length>0){this._onSelectionChanged()}base._onRowsRemoved.apply(this,arguments)},_createSelectAllHeader:function(){let self=this;let $columnHeader=$('<th class=""></th>').addClass("jtable-command-column jtable-command-column-header jtable-column-header-select");this._jqueryuiThemeAddClass($columnHeader,"ui-state-default");let $headerContainer=$("<div />").addClass("jtable-column-header-container").appendTo($columnHeader);self._$selectAllCheckbox=$('<input type="checkbox" />').appendTo($headerContainer).click(function(){if(self._$tableRows.length<=0){self._$selectAllCheckbox.attr("checked",false);return}let allRows=self._$tableBody.find(">tr.jtable-data-row");if(self._$selectAllCheckbox.is(":checked")){self._selectRows(allRows)}else{self._deselectRows(allRows)}self._onSelectionChanged()});return $columnHeader},_storeSelectionList:function(){let self=this;if(!self.options.selecting){return}self._selectedRecordIdsBeforeLoad=[];self._getSelectedRows().each(function(){self._selectedRecordIdsBeforeLoad.push(self._getKeyValueOfRecord($(this).data("record")))})},_restoreSelectionList:function(){let self=this;if(!self.options.selecting){return}let selectedRowCount=0;for(let i=0;i<self._$tableRows.length;++i){let recordId=self._getKeyValueOfRecord(self._$tableRows[i].data("record"));if($.inArray(recordId,self._selectedRecordIdsBeforeLoad)>-1){self._selectRows(self._$tableRows[i]);++selectedRowCount}}if(self._selectedRecordIdsBeforeLoad.length>0&&self._selectedRecordIdsBeforeLoad.length!=selectedRowCount){self._onSelectionChanged()}self._selectedRecordIdsBeforeLoad=[];self._refreshSelectAllCheckboxState()},_getSelectedRows:function(){return this._$tableBody.find(">tr.jtable-row-selected")},_makeRowSelectable:function($row){let self=this;if(self.options.selectOnRowClick){$row.click(function(){self._invertRowSelection($row)})}if(self.options.selectingCheckboxes){let $cell=$("<td></td>").addClass("jtable-command-column jtable-selecting-column");let $selectCheckbox=$('<input type="checkbox" />').appendTo($cell);if(!self.options.selectOnRowClick){$selectCheckbox.click(function(){self._invertRowSelection($row)})}$row.append($cell)}},_invertRowSelection:function($row){if($row.hasClass("jtable-row-selected")){this._deselectRows($row)}else{if(this._shiftKeyDown){let rowIndex=this._findRowIndex($row);let beforeIndex=this._findFirstSelectedRowIndexBeforeIndex(rowIndex)+1;if(beforeIndex>0&&beforeIndex<rowIndex){this._selectRows(this._$tableBody.find("tr").slice(beforeIndex,rowIndex+1))}else{let afterIndex=this._findFirstSelectedRowIndexAfterIndex(rowIndex)-1;if(afterIndex>rowIndex){this._selectRows(this._$tableBody.find("tr").slice(rowIndex,afterIndex+1))}else{this._selectRows($row)}}}else{this._selectRows($row)}}this._onSelectionChanged()},_findFirstSelectedRowIndexBeforeIndex:function(rowIndex){for(let i=rowIndex-1;i>=0;--i){if(this._$tableRows[i].hasClass("jtable-row-selected")){return i}}return-1},_findFirstSelectedRowIndexAfterIndex:function(rowIndex){for(let i=rowIndex+1;i<this._$tableRows.length;++i){if(this._$tableRows[i].hasClass("jtable-row-selected")){return i}}return-1},_selectRows:function($rows){if(!this.options.multiselect){this._deselectRows(this._getSelectedRows())}$rows.addClass("jtable-row-selected");this._jqueryuiThemeAddClass($rows,"ui-state-highlight");if(this.options.selectingCheckboxes){$rows.find(">td.jtable-selecting-column >input").prop("checked",true)}this._refreshSelectAllCheckboxState()},_deselectRows:function($rows){$rows.removeClass("jtable-row-selected ui-state-highlight");if(this.options.selectingCheckboxes){$rows.find(">td.jtable-selecting-column >input").prop("checked",false)}this._refreshSelectAllCheckboxState()},_refreshSelectAllCheckboxState:function(){if(!this.options.selectingCheckboxes||!this.options.multiselect){return}let totalRowCount=this._$tableRows.length;let selectedRowCount=this._getSelectedRows().length;if(selectedRowCount==0){this._$selectAllCheckbox.prop("indeterminate",false);this._$selectAllCheckbox.attr("checked",false)}else if(selectedRowCount==totalRowCount){this._$selectAllCheckbox.prop("indeterminate",false);this._$selectAllCheckbox.attr("checked",true)}else{this._$selectAllCheckbox.attr("checked",false);this._$selectAllCheckbox.prop("indeterminate",true)}},_onSelectionChanged:function(){this._$mainContainer.trigger("selectionChanged",{})}})})(jQuery);(function($){let base={load:jTable.prototype.load,_create:jTable.prototype._create,_setOption:jTable.prototype._setOption,_createJtParamsForLoading:jTable.prototype._createJtParamsForLoading,_addRowToTable:jTable.prototype._addRowToTable,_addRow:jTable.prototype._addRow,_removeRowsFromTable:jTable.prototype._removeRowsFromTable,_onRecordsLoaded:jTable.prototype._onRecordsLoaded};$.extend(true,jTable.prototype,{options:{paging:false,pageList:"normal",pageSize:10,pageSizes:[10,25,50,100,250,500],pageSizeChangeArea:true,gotoPageArea:"combobox",messages:{pagingInfo:"Showing {0}-{1} of {2}",pageSizeChangeLabel:"Row count",gotoPageLabel:"Go to page"}},_$bottomPanel:null,_$pagingListArea:null,_$pageSizeChangeArea:null,_$pageInfoSpan:null,_$gotoPageArea:null,_$gotoPageInput:null,_totalRecordCount:0,_currentPageNo:1,_create:function(){base._create.apply(this,arguments);if(this.options.paging){this._loadPagingSettings();this._createBottomPanel();this._createPageListArea();this._createGotoPageInput();this._createPageSizeSelection()}},_loadPagingSettings:function(){if(!this.options.saveUserPreferences){return}let pageSize=this._getCookie("page-size");if(pageSize){this.options.pageSize=this._normalizeNumber(pageSize,1,1e6,this.options.pageSize)}},_createBottomPanel:function(){this._$bottomPanel=$("<div />").addClass("jtable-bottom-panel").insertAfter(this._$tableDiv);this._jqueryuiThemeAddClass(this._$bottomPanel,"ui-state-default");$("<div />").addClass("jtable-left-area").appendTo(this._$bottomPanel);$("<div />").addClass("jtable-right-area").appendTo(this._$bottomPanel)},_createPageListArea:function(){this._$pagingListArea=$("<span></span>").addClass("jtable-page-list").appendTo(this._$bottomPanel.find(".jtable-left-area"));this._$pageInfoSpan=$("<span></span>").addClass("jtable-page-info").appendTo(this._$bottomPanel.find(".jtable-right-area"))},_createPageSizeSelection:function(){let self=this;if(!self.options.pageSizeChangeArea){return}if(self._findIndexInArray(self.options.pageSize,self.options.pageSizes)<0){self.options.pageSizes.push(parseInt(self.options.pageSize));self.options.pageSizes.sort(function(a,b){return a-b})}self._$pageSizeChangeArea=$("<span></span>").addClass("jtable-page-size-change").appendTo(self._$bottomPanel.find(".jtable-left-area"));self._$pageSizeChangeArea.append("<span>"+self.options.messages.pageSizeChangeLabel+": </span>");let $pageSizeChangeCombobox=$("<select></select>").appendTo(self._$pageSizeChangeArea);for(let i=0;i<self.options.pageSizes.length;i++){$pageSizeChangeCombobox.append('<option value="'+self.options.pageSizes[i]+'">'+self.options.pageSizes[i]+"</option>")}$pageSizeChangeCombobox.val(self.options.pageSize);$pageSizeChangeCombobox.change(function(){self._changePageSize(parseInt($(this).val()))})},_createGotoPageInput:function(){let self=this;if(!self.options.gotoPageArea||self.options.gotoPageArea=="none"){return}this._$gotoPageArea=$("<span></span>").addClass("jtable-goto-page").appendTo(self._$bottomPanel.find(".jtable-left-area"));this._$gotoPageArea.append("<span>"+self.options.messages.gotoPageLabel+": </span>");if(self.options.gotoPageArea=="combobox"){self._$gotoPageInput=$("<select></select>").appendTo(this._$gotoPageArea).data("pageCount",1).change(function(){self._changePage(parseInt($(this).val()))});self._$gotoPageInput.append('<option value="1">1</option>')}else{self._$gotoPageInput=$('<input type="text" maxlength="10" value="'+self._currentPageNo+'" />').appendTo(this._$gotoPageArea).keypress(function(event){if(event.which==13){event.preventDefault();self._changePage(parseInt(self._$gotoPageInput.val()))}else if(event.which==43){event.preventDefault();self._changePage(parseInt(self._$gotoPageInput.val())+1)}else if(event.which==45){event.preventDefault();self._changePage(parseInt(self._$gotoPageInput.val())-1)}else{let isValid=47<event.keyCode&&event.keyCode<58&&event.shiftKey==false&&event.altKey==false||event.keyCode==8||event.keyCode==9;if(!isValid){event.preventDefault()}}})}},_refreshGotoPageInput:function(){if(!this.options.gotoPageArea||this.options.gotoPageArea=="none"){return}if(this._totalRecordCount<=0){this._$gotoPageArea.hide()}else{this._$gotoPageArea.show()}if(this.options.gotoPageArea=="combobox"){let oldPageCount=this._$gotoPageInput.data("pageCount");let currentPageCount=this._calculatePageCount();if(oldPageCount!=currentPageCount){this._$gotoPageInput.empty();let pageStep=1;if(currentPageCount>1e4){pageStep=100}else if(currentPageCount>5e3){pageStep=10}else if(currentPageCount>2e3){pageStep=5}else if(currentPageCount>1e3){pageStep=2}for(let i=pageStep;i<=currentPageCount;i+=pageStep){this._$gotoPageInput.append('<option value="'+i+'">'+i+"</option>")}this._$gotoPageInput.data("pageCount",currentPageCount)}}this._$gotoPageInput.val(this._currentPageNo)},load:function(){this._currentPageNo=1;base.load.apply(this,arguments)},_setOption:function(key,value){base._setOption.apply(this,arguments);if(key=="pageSize"){this._changePageSize(parseInt(value))}},_changePageSize:function(pageSize){if(pageSize==this.options.pageSize){return}this.options.pageSize=pageSize;let pageCount=this._calculatePageCount();if(this._currentPageNo>pageCount){this._currentPageNo=pageCount}if(this._currentPageNo<=0){this._currentPageNo=1}let $pageSizeChangeCombobox=this._$bottomPanel.find(".jtable-page-size-change select");if($pageSizeChangeCombobox.length>0){if(parseInt($pageSizeChangeCombobox.val())!=pageSize){let selectedOption=$pageSizeChangeCombobox.find("option[value="+pageSize+"]");if(selectedOption.length>0){$pageSizeChangeCombobox.val(pageSize)}}}this._savePagingSettings();this._reloadTable()},_savePagingSettings:function(){if(!this.options.saveUserPreferences){return}this._setCookie("page-size",this.options.pageSize)},_createJtParamsForLoading:function(){let jtParams=base._createJtParamsForLoading.apply(this,arguments);if(this.options.paging){jtParams.jtStartIndex=(this._currentPageNo-1)*this.options.pageSize;jtParams.jtPageSize=this.options.pageSize}return jtParams},_addRowToTable:function($tableRow,index,isNewRow){if(isNewRow&&this.options.paging){this._reloadTable();return}base._addRowToTable.apply(this,arguments)},_addRow:function($row,options){if(options&&options.isNewRow&&this.options.paging){this._reloadTable();return}base._addRow.apply(this,arguments)},_removeRowsFromTable:function($rows,reason){base._removeRowsFromTable.apply(this,arguments);if(this.options.paging){if(this._$tableRows.length<=0&&this._currentPageNo>1){--this._currentPageNo}this._reloadTable()}},_onRecordsLoaded:function(data){if(this.options.paging){this._totalRecordCount=data.TotalRecordCount;this._createPagingList();this._createPagingInfo();this._refreshGotoPageInput()}base._onRecordsLoaded.apply(this,arguments)},_addPagingInfoToUrl:function(url,pageNumber){if(!this.options.paging){return url}let jtStartIndex=(pageNumber-1)*this.options.pageSize;let jtPageSize=this.options.pageSize;return url+(url.indexOf("?")<0?"?":"&")+"jtStartIndex="+jtStartIndex+"&jtPageSize="+jtPageSize},_createPagingList:function(){if(this.options.pageSize<=0){return}this._$pagingListArea.empty();if(this._totalRecordCount<=0){return}let pageCount=this._calculatePageCount();this._createFirstAndPreviousPageButtons();if(this.options.pageList=="normal"){this._createPageNumberButtons(this._calculatePageNumbers(pageCount))}this._createLastAndNextPageButtons(pageCount);this._bindClickEventsToPageNumberButtons()},_createFirstAndPreviousPageButtons:function(){let $first=$("<span></span>").addClass("jtable-page-number-first").html("&lt&lt").data("pageNumber",1).appendTo(this._$pagingListArea);let $previous=$("<span></span>").addClass("jtable-page-number-previous").html("&lt").data("pageNumber",this._currentPageNo-1).appendTo(this._$pagingListArea);this._jqueryuiThemeAddClass($first,"ui-button ui-state-default","ui-state-hover");this._jqueryuiThemeAddClass($previous,"ui-button ui-state-default","ui-state-hover");if(this._currentPageNo<=1){$first.addClass("jtable-page-number-disabled");$previous.addClass("jtable-page-number-disabled");this._jqueryuiThemeAddClass($first,"ui-state-disabled");this._jqueryuiThemeAddClass($previous,"ui-state-disabled")}},_createLastAndNextPageButtons:function(pageCount){let $next=$("<span></span>").addClass("jtable-page-number-next").html("&gt").data("pageNumber",this._currentPageNo+1).appendTo(this._$pagingListArea);let $last=$("<span></span>").addClass("jtable-page-number-last").html("&gt&gt").data("pageNumber",pageCount).appendTo(this._$pagingListArea);this._jqueryuiThemeAddClass($next,"ui-button ui-state-default","ui-state-hover");this._jqueryuiThemeAddClass($last,"ui-button ui-state-default","ui-state-hover");if(this._currentPageNo>=pageCount){$next.addClass("jtable-page-number-disabled");$last.addClass("jtable-page-number-disabled");this._jqueryuiThemeAddClass($next,"ui-state-disabled");this._jqueryuiThemeAddClass($last,"ui-state-disabled")}},_createPageNumberButtons:function(pageNumbers){let previousNumber=0;for(let i=0;i<pageNumbers.length;i++){if(pageNumbers[i]-previousNumber>1){$("<span></span>").addClass("jtable-page-number-space").html("...").appendTo(this._$pagingListArea)}this._createPageNumberButton(pageNumbers[i]);previousNumber=pageNumbers[i]}},_createPageNumberButton:function(pageNumber){let $pageNumber=$("<span></span>").addClass("jtable-page-number").html(pageNumber).data("pageNumber",pageNumber).appendTo(this._$pagingListArea);this._jqueryuiThemeAddClass($pageNumber,"ui-button ui-state-default","ui-state-hover");if(this._currentPageNo==pageNumber){$pageNumber.addClass("jtable-page-number-active jtable-page-number-disabled");this._jqueryuiThemeAddClass($pageNumber,"ui-state-active")}},_calculatePageCount:function(){let pageCount=Math.floor(this._totalRecordCount/this.options.pageSize);if(this._totalRecordCount%this.options.pageSize!=0){++pageCount}return pageCount},_calculatePageNumbers:function(pageCount){if(pageCount<=4){let pageNumbers=[];for(let i=1;i<=pageCount;++i){pageNumbers.push(i)}return pageNumbers}else{let shownPageNumbers=[1,2,pageCount-1,pageCount];let previousPageNo=this._normalizeNumber(this._currentPageNo-1,1,pageCount,1);let nextPageNo=this._normalizeNumber(this._currentPageNo+1,1,pageCount,1);this._insertToArrayIfDoesNotExists(shownPageNumbers,previousPageNo);this._insertToArrayIfDoesNotExists(shownPageNumbers,this._currentPageNo);this._insertToArrayIfDoesNotExists(shownPageNumbers,nextPageNo);shownPageNumbers.sort(function(a,b){return a-b});return shownPageNumbers}},_createPagingInfo:function(){if(this._totalRecordCount<=0){this._$pageInfoSpan.empty();return}let startNo=(this._currentPageNo-1)*this.options.pageSize+1;let endNo=this._currentPageNo*this.options.pageSize;endNo=this._normalizeNumber(endNo,startNo,this._totalRecordCount,0);if(endNo>=startNo){let pagingInfoMessage=this._formatString(this.options.messages.pagingInfo,startNo,endNo,this._totalRecordCount);this._$pageInfoSpan.html(pagingInfoMessage)}},_bindClickEventsToPageNumberButtons:function(){let self=this;self._$pagingListArea.find(".jtable-page-number,.jtable-page-number-previous,.jtable-page-number-next,.jtable-page-number-first,.jtable-page-number-last").not(".jtable-page-number-disabled").click(function(e){e.preventDefault();self._changePage($(this).data("pageNumber"))})},_changePage:function(pageNo){pageNo=this._normalizeNumber(pageNo,1,this._calculatePageCount(),1);if(pageNo==this._currentPageNo){this._refreshGotoPageInput();return}this._currentPageNo=pageNo;this._reloadTable()}})})(jQuery);(function($){let base={_initializeFields:jTable.prototype._initializeFields,_normalizeFieldOptions:jTable.prototype._normalizeFieldOptions,_createHeaderCellForField:jTable.prototype._createHeaderCellForField,_createJtParamsForLoading:jTable.prototype._createJtParamsForLoading};$.extend(true,jTable.prototype,{options:{sorting:false,multiSorting:false,roomForSortableIcon:true,defaultSorting:""},_lastSorting:null,_initializeFields:function(){base._initializeFields.apply(this,arguments);this._lastSorting=[];if(this.options.sorting){this._buildDefaultSortingArray()}},_normalizeFieldOptions:function(fieldName,props){base._normalizeFieldOptions.apply(this,arguments);props.sorting=props.sorting!=false},_createHeaderCellForField:function(fieldName,field){let $headerCell=base._createHeaderCellForField.apply(this,arguments);if(this.options.sorting&&field.sorting){this._makeColumnSortable($headerCell,fieldName,field.initialSortingDirection)}return $headerCell},_buildDefaultSortingArray:function(){let self=this;$.each(self.options.defaultSorting.split(","),function(orderIndex,orderValue){$.each(self.options.fields,function(fieldName,fieldProps){if(fieldProps.sorting){let colOffset=orderValue.indexOf(fieldName);if(colOffset>-1){if(orderValue.toUpperCase().indexOf(" DESC",colOffset)>-1){self._lastSorting.push({fieldName:fieldName,sortOrder:"DESC"})}else{self._lastSorting.push({fieldName:fieldName,sortOrder:"ASC"})}}}})})},_makeColumnSortable:function($columnHeader,fieldName,initialSortingDirection){let self=this;if(self.options.roomForSortableIcon){$columnHeader.find(".jtable-column-header-text").append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")}$columnHeader.addClass("jtable-column-header-sortable").click(function(e){e.preventDefault();if(!self.options.multiSorting||!e.ctrlKey){self._lastSorting=[]}self._sortTableByColumn($columnHeader)});if(initialSortingDirection){$columnHeader.addClass("jtable-column-header-sorted-"+initialSortingDirection.toLowerCase())}$.each(this._lastSorting,function(sortIndex,sortField){if(sortField.fieldName==fieldName){if(sortField.sortOrder=="DESC"){$columnHeader.addClass("jtable-column-header-sorted-desc")}else{$columnHeader.addClass("jtable-column-header-sorted-asc")}}})},_sortTableByColumn:function($columnHeader){if(this._lastSorting.length==0){$columnHeader.siblings().removeClass("jtable-column-header-sorted-asc jtable-column-header-sorted-desc")}for(let i=0;i<this._lastSorting.length;i++){if(this._lastSorting[i].fieldName==$columnHeader.data("fieldName")){this._lastSorting.splice(i--,1)}}if($columnHeader.hasClass("jtable-column-header-sorted-asc")){$columnHeader.removeClass("jtable-column-header-sorted-asc").addClass("jtable-column-header-sorted-desc");this._lastSorting.push({fieldName:$columnHeader.data("fieldName"),sortOrder:"DESC"})}else if($columnHeader.hasClass("jtable-column-header-sorted-desc")){$columnHeader.removeClass("jtable-column-header-sorted-desc")}else{$columnHeader.addClass("jtable-column-header-sorted-asc");this._lastSorting.push({fieldName:$columnHeader.data("fieldName"),sortOrder:"ASC"})}this._reloadTable()},_addSortingInfoToUrl:function(url){if(!this.options.sorting||this._lastSorting.length==0){return url}let sorting=[];$.each(this._lastSorting,function(idx,value){sorting.push(value.fieldName+" "+value.sortOrder)});return url+(url.indexOf("?")<0?"?":"&")+"jtSorting="+sorting.join(",")},_createJtParamsForLoading:function(){let jtParams=base._createJtParamsForLoading.apply(this,arguments);if(this.options.sorting&&this._lastSorting.length){let sorting=[];$.each(this._lastSorting,function(idx,value){sorting.push(value.fieldName+" "+value.sortOrder)});jtParams.jtSorting=sorting.join(",")}return jtParams}})})(jQuery);(function($){let base={_create:jTable.prototype._create,_normalizeFieldOptions:jTable.prototype._normalizeFieldOptions,_createHeaderCellForField:jTable.prototype._createHeaderCellForField,_createCellForRecordField:jTable.prototype._createCellForRecordField};$.extend(true,jTable.prototype,{options:{columnResizable:true,columnSelectable:true},_$columnSelectionDiv:null,_$columnResizeBar:null,_cookieKeyPrefix:null,_currentResizeArgs:null,_create:function(){base._create.apply(this,arguments);this._createColumnResizeBar();this._createColumnSelection();if(this.options.saveUserPreferences){this._loadColumnSettings()}this._normalizeColumnWidths()},_normalizeFieldOptions:function(fieldName,props){base._normalizeFieldOptions.apply(this,arguments);if(this.options.columnResizable){props.columnResizable=props.columnResizable!=false}if(!props.visibility){props.visibility="visible"}},_createHeaderCellForField:function(fieldName,field){let $headerCell=base._createHeaderCellForField.apply(this,arguments);if(this.options.columnResizable&&field.columnResizable){this._makeColumnResizable($headerCell)}if(field.visibility=="hidden"||field.visibility=="separator"){$headerCell.hide()}return $headerCell},_createCellForRecordField:function(record,fieldName){let $column=base._createCellForRecordField.apply(this,arguments);let field=this.options.fields[fieldName];if(field.visibility=="hidden"||field.visibility=="separator"){$column.hide()}return $column},changeColumnVisibility:function(columnName,visibility){this._changeColumnVisibilityInternal(columnName,visibility);this._normalizeColumnWidths();if(this.options.saveUserPreferences){this._saveColumnSettings()}},_changeColumnVisibilityInternal:function(columnName,visibility){let columnIndex=this._columnList.indexOf(columnName);if(columnIndex<0){this._logWarn('Column "'+columnName+'" does not exist in fields!');return}if(["visible","hidden","fixed","separator"].indexOf(visibility)<0){this._logWarn('Visibility value is not valid: "'+visibility+'"! Options are: visible, hidden, fixed, separator.');return}let field=this.options.fields[columnName];if(field.visibility==visibility){return}let columnIndexInTable=this._firstDataColumnOffset+columnIndex+1;if(field.visibility!="hidden"&&field.visibility!="separator"&&(visibility=="hidden"||visibility=="separator")){this._$table.find(">thead >tr >th:nth-child("+columnIndexInTable+"),>tbody >tr >td:nth-child("+columnIndexInTable+")").hide()}else if(field.visibility=="hidden"&&visibility!="hidden"&&visibility!="separator"){this._$table.find(">thead >tr >th:nth-child("+columnIndexInTable+"),>tbody >tr >td:nth-child("+columnIndexInTable+")").show().css("display","table-cell")}field.visibility=visibility},_createColumnSelection:function(){let self=this;this._$columnSelectionDiv=$("<div />").addClass("jtable-column-selection-container").appendTo(self._$mainContainer);this._$table.children("thead").bind("contextmenu",function(e){if(!self.options.columnSelectable){return}e.preventDefault();$("<div />").addClass("jtable-contextmenu-overlay").click(function(){$(this).remove();self._$columnSelectionDiv.hide()}).bind("contextmenu",function(){return false}).appendTo(document.body);self._fillColumnSelection();let containerOffset=self._$mainContainer.offset();let selectionDivTop=e.pageY-containerOffset.top;let selectionDivLeft=e.pageX-containerOffset.left;let selectionDivMinWidth=100;let containerWidth=self._$mainContainer.width();if(containerWidth>selectionDivMinWidth&&selectionDivLeft>containerWidth-selectionDivMinWidth){selectionDivLeft=containerWidth-selectionDivMinWidth}self._$columnSelectionDiv.css({left:selectionDivLeft,top:selectionDivTop,"min-width":selectionDivMinWidth+"px"}).show()})},_fillColumnSelection:function(){let self=this;let $columnsUl=$("<ul></ul>").addClass("jtable-column-select-list");for(let i=0;i<self._columnList.length;i++){let columnName=self._columnList[i];let field=self.options.fields[columnName];let $columnLi=$("<li></li>").appendTo($columnsUl);let $label=$("<label></label>").append($("<span>"+(field.title||columnName)+"</span>")).appendTo($columnLi);if(field.visibility!="separator"){let $checkbox=$('<input type="checkbox" name="'+columnName+'">').prependTo($label).click(function(){let $clickedCheckbox=$(this);let clickedColumnName=$clickedCheckbox.attr("name");let clickedField=self.options.fields[clickedColumnName];if(clickedField.visibility=="fixed"){return}self.changeColumnVisibility(clickedColumnName,$clickedCheckbox.is(":checked")?"visible":"hidden")});if(field.visibility!="hidden"){$checkbox.attr("checked","checked")}if(field.visibility=="fixed"){$checkbox.attr("disabled","disabled")}}}this._$columnSelectionDiv.html($columnsUl)},_createColumnResizeBar:function(){this._$columnResizeBar=$("<div />").addClass("jtable-column-resize-bar").appendTo(this._$mainContainer).hide()},_makeColumnResizable:function($columnHeader){let self=this;$("<div />").addClass("jtable-column-resize-handler").appendTo($columnHeader.find(".jtable-column-header-container")).mousedown(function(downevent){downevent.preventDefault();downevent.stopPropagation();let mainContainerOffset=self._$mainContainer.offset();let $nextColumnHeader=$columnHeader.nextAll("th.jtable-column-header:visible:first");if($nextColumnHeader.length){nextColumnOuterWidth=$nextColumnHeader.outerWidth()}else{nextColumnOuterWidth=0}let minimumColumnWidth=10;self._currentResizeArgs={currentColumnStartWidth:$columnHeader.outerWidth(),minWidth:minimumColumnWidth,maxWidth:$columnHeader.outerWidth()+nextColumnOuterWidth,mouseStartX:downevent.pageX,minResizeX:function(){return this.mouseStartX-(this.currentColumnStartWidth-this.minWidth)},maxResizeX:function(){return this.mouseStartX+(this.maxWidth-this.currentColumnStartWidth)}};let resizeonmousemove=function(moveevent){if(!self._currentResizeArgs){return}let resizeBarX=self._normalizeNumber(moveevent.pageX,self._currentResizeArgs.minResizeX(),self._currentResizeArgs.maxResizeX());self._$columnResizeBar.css("left",resizeBarX-mainContainerOffset.left+"px")};let resizeonmouseup=function(upevent){if(!self._currentResizeArgs){return}$(document).unbind("mousemove",resizeonmousemove);$(document).unbind("mouseup",resizeonmouseup);self._$columnResizeBar.hide();let mouseChangeX=upevent.pageX-self._currentResizeArgs.mouseStartX;let currentColumnFinalWidth=self._normalizeNumber(self._currentResizeArgs.currentColumnStartWidth+mouseChangeX,self._currentResizeArgs.minWidth,self._currentResizeArgs.maxWidth);let pixelToPercentRatio=$columnHeader.data("width-in-percent")/self._currentResizeArgs.currentColumnStartWidth;$columnHeader.data("width-in-percent",currentColumnFinalWidth*pixelToPercentRatio);$columnHeader.css("width",$columnHeader.data("width-in-percent")+"%");if($nextColumnHeader.length){let nextColumnFinalWidth=nextColumnOuterWidth+(self._currentResizeArgs.currentColumnStartWidth-currentColumnFinalWidth);$nextColumnHeader.data("width-in-percent",nextColumnFinalWidth*pixelToPercentRatio);$nextColumnHeader.css("width",$nextColumnHeader.data("width-in-percent")+"%")}self._normalizeColumnWidths();self._currentResizeArgs=null;if(self.options.saveUserPreferences){self._saveColumnSettings()}};self._$columnResizeBar.show().css({top:$columnHeader.offset().top-mainContainerOffset.top+"px",left:downevent.pageX-mainContainerOffset.left+"px",height:self._$table.outerHeight()+"px"});$(document).bind("mousemove",resizeonmousemove);$(document).bind("mouseup",resizeonmouseup)})},_normalizeColumnWidths:function(){let self=this;let commandColumnHeaders=self._$table.find(">thead th.jtable-command-column-header").data("width-in-percent",1).css("width","1%");let headerCells=self._$table.find(">thead th");let totalWidthInPixel=self._$table.outerWidth();let columnWidths={};headerCells.each(function(){let $cell=$(this);if($cell.is(":visible")){let fieldName=$cell.data("fieldName");let widthInPercent=$cell.outerWidth()*100/totalWidthInPixel;columnWidths[fieldName]=widthInPercent}});headerCells.each(function(){let $cell=$(this);if($cell.is(":visible")){let fieldName=$cell.data("fieldName");$cell.data("width-in-percent",columnWidths[fieldName]).css("width",columnWidths[fieldName]+"%")}else{$cell.data("width-in-percent",1).css("width","1%")}})},_saveColumnSettings:function(){let self=this;let fieldSettings="";self._$table.find(">thead >tr >th.jtable-column-header").each(function(){let $cell=$(this);let fieldName=$cell.data("fieldName");let columnWidth=$cell.data("width-in-percent");let fieldVisibility=self.options.fields[fieldName].visibility;let fieldSetting=fieldName+"="+fieldVisibility+";"+columnWidth;fieldSettings=fieldSettings+fieldSetting+"|"});this._setCookie("column-settings",fieldSettings.substr(0,fieldSettings.length-1))},_loadColumnSettings:function(){let self=this;let columnSettingsCookie=self._getCookie("column-settings");if(!columnSettingsCookie){return}let columnSettings={};$.each(columnSettingsCookie.split("|"),function(inx,fieldSetting){let splitted=fieldSetting.split("=");let fieldName=splitted[0];let settings=splitted[1].split(";");columnSettings[fieldName]={columnVisibility:settings[0],columnWidth:settings[1]}});let headerCells=self._$table.find(">thead >tr >th.jtable-column-header");headerCells.each(function(){let $cell=$(this);let fieldName=$cell.data("fieldName");let field=self.options.fields[fieldName];if(columnSettings[fieldName]){if(field.visibility!="fixed"){self._changeColumnVisibilityInternal(fieldName,columnSettings[fieldName].columnVisibility)}$cell.data("width-in-percent",columnSettings[fieldName].columnWidth).css("width",columnSettings[fieldName].columnWidth+"%")}})}})})(jQuery);(function($){let base={_removeRowsFromTable:jTable.prototype._removeRowsFromTable};$.extend(true,jTable.prototype,{options:{openChildAsAccordion:false},openChildTable:function($row,tableOptions,opened){let self=this;if(tableOptions.jqueryuiTheme==undefined){tableOptions.jqueryuiTheme=self.options.jqueryuiTheme}tableOptions.showCloseButton=tableOptions.showCloseButton!=false;if(tableOptions.showCloseButton&&!tableOptions.closeRequested){tableOptions.closeRequested=function(){self.closeChildTable($row)}}if(self.options.openChildAsAccordion){$row.siblings(".jtable-data-row").each(function(){self.closeChildTable($(this))})}self.closeChildTable($row,function(){let $childRowColumn=self.getChildRow($row).children("td").empty();let $childTableContainer=$("<div />").addClass("jtable-child-table-container").appendTo($childRowColumn);$childRowColumn.data("childTable",$childTableContainer);$childTableContainer.jtable(tableOptions);self.openChildRow($row);$childTableContainer.hide().slideDown("fast",function(){if(opened){opened({childTable:$childTableContainer})}})})},closeChildTable:function($row,closed){let self=this;let $childRowColumn=self.getChildRow($row).children("td");let $childTable=$childRowColumn.data("childTable");if(!$childTable){if(closed){closed()}return}$childRowColumn.data("childTable",null);$childTable.slideUp("fast",function(){$childTable.jtable("destroy");$childTable.remove();self.closeChildRow($row);if(closed){closed()}})},isChildRowOpen:function($row){return this.getChildRow($row).is(":visible")},getChildRow:function($row){return $row.data("childRow")||this._createChildRow($row)},openChildRow:function($row){let $childRow=this.getChildRow($row);if(!$childRow.is(":visible")){$childRow.show()}return $childRow},closeChildRow:function($row){let $childRow=this.getChildRow($row);if($childRow.is(":visible")){$childRow.hide()}},_removeRowsFromTable:function($rows,reason){if(reason=="deleted"){$rows.each(function(){let $row=$(this);let $childRow=$row.data("childRow");if($childRow){$childRow.remove()}})}base._removeRowsFromTable.apply(this,arguments)},_createChildRow:function($row){let totalColumnCount=this._$table.find("thead th").length;let $childRow=$("<tr></tr>").addClass("jtable-child-row").append('<td colspan="'+totalColumnCount+'"></td>');$row.after($childRow);$row.data("childRow",$childRow);$childRow.hide();return $childRow}})})(jQuery);